#!/bin/bash
#===============================================================================
# LightAP Systemd Service Uninstallation Script
# Automatically generated by CMake from BuildTemplate/systemd/uninstall-service.sh.in
#
# This script is used to cleanly remove the daemon from systemd
#===============================================================================

set -e

SERVICE_NAME="@DaemonService@.service"

echo "==================================================================="
echo "Uninstalling systemd service: ${SERVICE_NAME}"
echo "==================================================================="

# Check if running with sufficient privileges
if [ "$EUID" -ne 0 ]; then
    echo "Error: This script must be run as root"
    echo "Usage: sudo $0"
    exit 1
fi

# Check if service exists
if systemctl list-unit-files | grep -q "^${SERVICE_NAME}"; then
    # Stop the service if running
    if systemctl is-active --quiet "${SERVICE_NAME}"; then
        echo "Stopping ${SERVICE_NAME}..."
        systemctl stop "${SERVICE_NAME}"
    fi
    
    # Disable the service if enabled
    if systemctl is-enabled --quiet "${SERVICE_NAME}" 2>/dev/null; then
        echo "Disabling ${SERVICE_NAME}..."
        systemctl disable "${SERVICE_NAME}"
    fi
    
    echo "Service stopped and disabled."
else
    echo "Service ${SERVICE_NAME} not found in systemd."
fi

# Reload systemd daemon
echo "Reloading systemd daemon..."
systemctl daemon-reload
systemctl reset-failed || true

echo ""
echo "==================================================================="
echo "Service ${SERVICE_NAME} uninstalled successfully."
echo "==================================================================="

exit 0
